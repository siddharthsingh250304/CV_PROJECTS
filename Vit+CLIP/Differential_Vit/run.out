==========================================
SLURM_JOB_ID = 2415456
SLURM_NODELIST = gnode010
SLURM_JOB_GPUS = 0
==========================================
job started at Sun Apr 20 23:05:36 IST 2025
Running Python script: train_diff_vit.py
Using device: cuda

=== Starting Diff-ViT Sequential Tuning (2025-04-20 23:05:43) ===

=============== Stage 1: Patch Size Tuning (20 Epochs) ===============

--- Testing S1_Patch_4 (Diff-ViT) ---

--- Running Tuning Config: S1_Patch_4 ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 192,
  "depth": 6,
  "num_heads": 6,
  "mlp_ratio": 4.0,
  "batch_size": 128,
  "learning_rate": 0.0005,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: None
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 3,582,544
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 2.0793, Acc: 0.2250 | Val Loss: 1.7969, Acc: 0.3382 | LR: 1.0e-04
✨ New best val acc: 0.3382
Epoch 2/20 - Train Loss: 1.6342, Acc: 0.4035 | Val Loss: 1.5301, Acc: 0.4276 | LR: 2.0e-04
✨ New best val acc: 0.4276
Epoch 3/20 - Train Loss: 1.4356, Acc: 0.4782 | Val Loss: 1.3163, Acc: 0.5236 | LR: 3.0e-04
✨ New best val acc: 0.5236
Epoch 4/20 - Train Loss: 1.3154, Acc: 0.5246 | Val Loss: 1.2401, Acc: 0.5480 | LR: 4.0e-04
✨ New best val acc: 0.5480
Epoch 5/20 - Train Loss: 1.2223, Acc: 0.5584 | Val Loss: 1.2096, Acc: 0.5616 | LR: 5.0e-04
✨ New best val acc: 0.5616
Epoch 6/20 - Train Loss: 1.1382, Acc: 0.5873 | Val Loss: 1.0966, Acc: 0.5968 | LR: 4.9e-04
✨ New best val acc: 0.5968
Epoch 7/20 - Train Loss: 1.0605, Acc: 0.6184 | Val Loss: 1.0848, Acc: 0.6046 | LR: 4.8e-04
✨ New best val acc: 0.6046
Epoch 8/20 - Train Loss: 0.9937, Acc: 0.6422 | Val Loss: 1.0226, Acc: 0.6344 | LR: 4.5e-04
✨ New best val acc: 0.6344
Epoch 9/20 - Train Loss: 0.9290, Acc: 0.6680 | Val Loss: 0.9869, Acc: 0.6508 | LR: 4.2e-04
✨ New best val acc: 0.6508
Epoch 10/20 - Train Loss: 0.8718, Acc: 0.6874 | Val Loss: 0.9496, Acc: 0.6572 | LR: 3.8e-04
✨ New best val acc: 0.6572
Epoch 11/20 - Train Loss: 0.8167, Acc: 0.7056 | Val Loss: 0.9637, Acc: 0.6572 | LR: 3.3e-04
Epoch 12/20 - Train Loss: 0.7567, Acc: 0.7294 | Val Loss: 0.9354, Acc: 0.6716 | LR: 2.8e-04
✨ New best val acc: 0.6716
Epoch 13/20 - Train Loss: 0.6847, Acc: 0.7559 | Val Loss: 0.9407, Acc: 0.6752 | LR: 2.2e-04
✨ New best val acc: 0.6752
Epoch 14/20 - Train Loss: 0.6199, Acc: 0.7775 | Val Loss: 0.9231, Acc: 0.6908 | LR: 1.7e-04
✨ New best val acc: 0.6908
Epoch 15/20 - Train Loss: 0.5509, Acc: 0.8023 | Val Loss: 0.9292, Acc: 0.6964 | LR: 1.3e-04
✨ New best val acc: 0.6964
Epoch 16/20 - Train Loss: 0.4846, Acc: 0.8267 | Val Loss: 0.9425, Acc: 0.6960 | LR: 8.4e-05
Epoch 17/20 - Train Loss: 0.4255, Acc: 0.8474 | Val Loss: 0.9613, Acc: 0.7010 | LR: 4.9e-05
✨ New best val acc: 0.7010
Epoch 18/20 - Train Loss: 0.3762, Acc: 0.8659 | Val Loss: 0.9709, Acc: 0.7068 | LR: 2.3e-05
✨ New best val acc: 0.7068
Epoch 19/20 - Train Loss: 0.3445, Acc: 0.8809 | Val Loss: 0.9800, Acc: 0.7056 | LR: 6.5e-06
Epoch 20/20 - Train Loss: 0.3328, Acc: 0.8840 | Val Loss: 0.9842, Acc: 0.7072 | LR: 1.0e-06
✨ New best val acc: 0.7072
Training finished in 10.70 min. Best Val Acc: 0.7072
Final Test Accuracy (using best val wts): 0.6993
S1_Patch_4: Best Val Acc = 0.7072, Final Test Acc = 0.6993
*** New best for Stage 1: S1_Patch_4 (Val Acc: 0.7072) ***
*** New OVERALL Best Diff-ViT Found! (From S1_Patch_4, Val Acc: 0.7072) ***

--- Testing S1_Patch_8 (Diff-ViT) ---

--- Running Tuning Config: S1_Patch_8 ---
Parameters: {
  "img_size": 32,
  "patch_size": 8,
  "embed_dim": 192,
  "depth": 6,
  "num_heads": 6,
  "mlp_ratio": 4.0,
  "batch_size": 256,
  "learning_rate": 0.0005,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: None
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 3,600,976
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 2.1769, Acc: 0.1818 | Val Loss: 1.8876, Acc: 0.3110 | LR: 1.0e-04
✨ New best val acc: 0.3110
Epoch 2/20 - Train Loss: 1.7867, Acc: 0.3428 | Val Loss: 1.6823, Acc: 0.3902 | LR: 2.0e-04
✨ New best val acc: 0.3902
Epoch 3/20 - Train Loss: 1.6068, Acc: 0.4177 | Val Loss: 1.5166, Acc: 0.4442 | LR: 3.0e-04
✨ New best val acc: 0.4442
Epoch 4/20 - Train Loss: 1.4867, Acc: 0.4611 | Val Loss: 1.4685, Acc: 0.4712 | LR: 4.0e-04
✨ New best val acc: 0.4712
Epoch 5/20 - Train Loss: 1.3979, Acc: 0.4953 | Val Loss: 1.3850, Acc: 0.5040 | LR: 5.0e-04
✨ New best val acc: 0.5040
Epoch 6/20 - Train Loss: 1.3188, Acc: 0.5215 | Val Loss: 1.3127, Acc: 0.5298 | LR: 4.9e-04
✨ New best val acc: 0.5298
Epoch 7/20 - Train Loss: 1.2433, Acc: 0.5509 | Val Loss: 1.2367, Acc: 0.5626 | LR: 4.8e-04
✨ New best val acc: 0.5626
Epoch 8/20 - Train Loss: 1.1743, Acc: 0.5752 | Val Loss: 1.2289, Acc: 0.5558 | LR: 4.5e-04
Epoch 9/20 - Train Loss: 1.1162, Acc: 0.5946 | Val Loss: 1.2227, Acc: 0.5722 | LR: 4.2e-04
✨ New best val acc: 0.5722
Epoch 10/20 - Train Loss: 1.0557, Acc: 0.6188 | Val Loss: 1.1870, Acc: 0.5740 | LR: 3.8e-04
✨ New best val acc: 0.5740
Epoch 11/20 - Train Loss: 0.9851, Acc: 0.6453 | Val Loss: 1.1615, Acc: 0.5964 | LR: 3.3e-04
✨ New best val acc: 0.5964
Epoch 12/20 - Train Loss: 0.9239, Acc: 0.6685 | Val Loss: 1.1416, Acc: 0.5994 | LR: 2.8e-04
✨ New best val acc: 0.5994
Epoch 13/20 - Train Loss: 0.8561, Acc: 0.6919 | Val Loss: 1.1602, Acc: 0.6040 | LR: 2.2e-04
✨ New best val acc: 0.6040
Epoch 14/20 - Train Loss: 0.7875, Acc: 0.7191 | Val Loss: 1.1587, Acc: 0.6032 | LR: 1.7e-04
Epoch 15/20 - Train Loss: 0.7185, Acc: 0.7406 | Val Loss: 1.1670, Acc: 0.6142 | LR: 1.3e-04
✨ New best val acc: 0.6142
Epoch 16/20 - Train Loss: 0.6582, Acc: 0.7637 | Val Loss: 1.1988, Acc: 0.6154 | LR: 8.4e-05
✨ New best val acc: 0.6154
Epoch 17/20 - Train Loss: 0.5984, Acc: 0.7850 | Val Loss: 1.2120, Acc: 0.6154 | LR: 4.9e-05
Epoch 18/20 - Train Loss: 0.5567, Acc: 0.8008 | Val Loss: 1.2143, Acc: 0.6226 | LR: 2.3e-05
✨ New best val acc: 0.6226
Epoch 19/20 - Train Loss: 0.5376, Acc: 0.8082 | Val Loss: 1.2237, Acc: 0.6202 | LR: 6.5e-06
Epoch 20/20 - Train Loss: 0.5244, Acc: 0.8136 | Val Loss: 1.2260, Acc: 0.6236 | LR: 1.0e-06
✨ New best val acc: 0.6236
Training finished in 3.32 min. Best Val Acc: 0.6236
Final Test Accuracy (using best val wts): 0.6092
S1_Patch_8: Best Val Acc = 0.6236, Final Test Acc = 0.6092

--- Stage 1 Result (Duration: 14.20 min): Best Patch Size = 4 (Val Acc: 0.7072) ---

--- Saving Best Results for Stage1_Patch (ID: S1_Patch_4, Val Acc: 0.7072) ---
[Stage1_Patch] Saved best config to results_diff_vit_tuned/best_config_diff_vit_S1_Patch_4.json
[Stage1_Patch] Saved best model state_dict to results_diff_vit_tuned/models/best_diff_vit_S1_Patch_4.pth
Saved plot: best_curves_diff_vit_S1_Patch_4.png

=============== Stage 2: Model Parameter Tuning (20 Epochs) ===============

--- Testing S2_Param_baseline_m (Diff-ViT) ---

--- Running Tuning Config: S2_Param_baseline_m ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 256,
  "depth": 8,
  "num_heads": 8,
  "mlp_ratio": 4.0,
  "batch_size": 128,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 8,454,930
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.9525, Acc: 0.2781 | Val Loss: 1.6359, Acc: 0.4110 | LR: 6.0e-05
✨ New best val acc: 0.4110
Epoch 2/20 - Train Loss: 1.4961, Acc: 0.4574 | Val Loss: 1.3378, Acc: 0.5110 | LR: 1.2e-04
✨ New best val acc: 0.5110
Epoch 3/20 - Train Loss: 1.2988, Acc: 0.5307 | Val Loss: 1.2053, Acc: 0.5678 | LR: 1.8e-04
✨ New best val acc: 0.5678
Epoch 4/20 - Train Loss: 1.1649, Acc: 0.5809 | Val Loss: 1.1287, Acc: 0.6024 | LR: 2.4e-04
✨ New best val acc: 0.6024
Epoch 5/20 - Train Loss: 1.0587, Acc: 0.6182 | Val Loss: 1.0244, Acc: 0.6314 | LR: 3.0e-04
✨ New best val acc: 0.6314
Epoch 6/20 - Train Loss: 0.9694, Acc: 0.6529 | Val Loss: 0.9726, Acc: 0.6556 | LR: 3.0e-04
✨ New best val acc: 0.6556
Epoch 7/20 - Train Loss: 0.8920, Acc: 0.6794 | Val Loss: 0.8993, Acc: 0.6832 | LR: 2.9e-04
✨ New best val acc: 0.6832
Epoch 8/20 - Train Loss: 0.8188, Acc: 0.7077 | Val Loss: 0.8589, Acc: 0.6960 | LR: 2.7e-04
✨ New best val acc: 0.6960
Epoch 9/20 - Train Loss: 0.7542, Acc: 0.7308 | Val Loss: 0.8310, Acc: 0.7036 | LR: 2.5e-04
✨ New best val acc: 0.7036
Epoch 10/20 - Train Loss: 0.6975, Acc: 0.7514 | Val Loss: 0.8129, Acc: 0.7194 | LR: 2.3e-04
✨ New best val acc: 0.7194
Epoch 11/20 - Train Loss: 0.6327, Acc: 0.7742 | Val Loss: 0.7975, Acc: 0.7288 | LR: 2.0e-04
✨ New best val acc: 0.7288
Epoch 12/20 - Train Loss: 0.5666, Acc: 0.7981 | Val Loss: 0.7675, Acc: 0.7454 | LR: 1.7e-04
✨ New best val acc: 0.7454
Epoch 13/20 - Train Loss: 0.5033, Acc: 0.8212 | Val Loss: 0.7907, Acc: 0.7502 | LR: 1.3e-04
✨ New best val acc: 0.7502
Epoch 14/20 - Train Loss: 0.4371, Acc: 0.8460 | Val Loss: 0.8029, Acc: 0.7512 | LR: 1.0e-04
✨ New best val acc: 0.7512
Epoch 15/20 - Train Loss: 0.3837, Acc: 0.8659 | Val Loss: 0.8074, Acc: 0.7558 | LR: 7.6e-05
✨ New best val acc: 0.7558
Epoch 16/20 - Train Loss: 0.3298, Acc: 0.8844 | Val Loss: 0.8196, Acc: 0.7632 | LR: 5.0e-05
✨ New best val acc: 0.7632
Epoch 17/20 - Train Loss: 0.2873, Acc: 0.9013 | Val Loss: 0.8459, Acc: 0.7588 | LR: 3.0e-05
Epoch 18/20 - Train Loss: 0.2552, Acc: 0.9135 | Val Loss: 0.8577, Acc: 0.7624 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.2380, Acc: 0.9201 | Val Loss: 0.8640, Acc: 0.7646 | LR: 4.3e-06
✨ New best val acc: 0.7646
Epoch 20/20 - Train Loss: 0.2275, Acc: 0.9237 | Val Loss: 0.8665, Acc: 0.7648 | LR: 1.0e-06
✨ New best val acc: 0.7648
Training finished in 38.15 min. Best Val Acc: 0.7648
Final Test Accuracy (using best val wts): 0.7717
S2_Param_baseline_m: Best Val Acc = 0.7648, Final Test Acc = 0.7717
*** New best for Stage 2: S2_Param_baseline_m (Val Acc: 0.7648) ***
*** New OVERALL Best Diff-ViT Found! (From S2_Param_baseline_m, Val Acc: 0.7648) ***

--- Testing S2_Param_mlp_ratio_2 (Diff-ViT) ---

--- Running Tuning Config: S2_Param_mlp_ratio_2 ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 256,
  "depth": 8,
  "num_heads": 8,
  "mlp_ratio": 2.0,
  "batch_size": 128,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 6,353,682
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.9825, Acc: 0.2652 | Val Loss: 1.6506, Acc: 0.4040 | LR: 6.0e-05
✨ New best val acc: 0.4040
Epoch 2/20 - Train Loss: 1.5214, Acc: 0.4458 | Val Loss: 1.3348, Acc: 0.5182 | LR: 1.2e-04
✨ New best val acc: 0.5182
Epoch 3/20 - Train Loss: 1.3164, Acc: 0.5232 | Val Loss: 1.1932, Acc: 0.5730 | LR: 1.8e-04
✨ New best val acc: 0.5730
Epoch 4/20 - Train Loss: 1.1737, Acc: 0.5781 | Val Loss: 1.1140, Acc: 0.5982 | LR: 2.4e-04
✨ New best val acc: 0.5982
Epoch 5/20 - Train Loss: 1.0605, Acc: 0.6193 | Val Loss: 1.0379, Acc: 0.6312 | LR: 3.0e-04
✨ New best val acc: 0.6312
Epoch 6/20 - Train Loss: 0.9756, Acc: 0.6511 | Val Loss: 0.9462, Acc: 0.6566 | LR: 3.0e-04
✨ New best val acc: 0.6566
Epoch 7/20 - Train Loss: 0.8945, Acc: 0.6811 | Val Loss: 0.9353, Acc: 0.6656 | LR: 2.9e-04
✨ New best val acc: 0.6656
Epoch 8/20 - Train Loss: 0.8256, Acc: 0.7052 | Val Loss: 0.8833, Acc: 0.6854 | LR: 2.7e-04
✨ New best val acc: 0.6854
Epoch 9/20 - Train Loss: 0.7650, Acc: 0.7287 | Val Loss: 0.8371, Acc: 0.7164 | LR: 2.5e-04
✨ New best val acc: 0.7164
Epoch 10/20 - Train Loss: 0.6967, Acc: 0.7507 | Val Loss: 0.8420, Acc: 0.7086 | LR: 2.3e-04
Epoch 11/20 - Train Loss: 0.6390, Acc: 0.7727 | Val Loss: 0.8221, Acc: 0.7290 | LR: 2.0e-04
✨ New best val acc: 0.7290
Epoch 12/20 - Train Loss: 0.5713, Acc: 0.7959 | Val Loss: 0.8209, Acc: 0.7370 | LR: 1.7e-04
✨ New best val acc: 0.7370
Epoch 13/20 - Train Loss: 0.5090, Acc: 0.8189 | Val Loss: 0.8040, Acc: 0.7450 | LR: 1.3e-04
✨ New best val acc: 0.7450
Epoch 14/20 - Train Loss: 0.4428, Acc: 0.8429 | Val Loss: 0.8178, Acc: 0.7420 | LR: 1.0e-04
Epoch 15/20 - Train Loss: 0.3820, Acc: 0.8672 | Val Loss: 0.8514, Acc: 0.7460 | LR: 7.6e-05
✨ New best val acc: 0.7460
Epoch 16/20 - Train Loss: 0.3324, Acc: 0.8851 | Val Loss: 0.8680, Acc: 0.7450 | LR: 5.0e-05
Epoch 17/20 - Train Loss: 0.2885, Acc: 0.9011 | Val Loss: 0.8631, Acc: 0.7548 | LR: 3.0e-05
✨ New best val acc: 0.7548
Epoch 18/20 - Train Loss: 0.2602, Acc: 0.9106 | Val Loss: 0.8826, Acc: 0.7552 | LR: 1.4e-05
✨ New best val acc: 0.7552
Epoch 19/20 - Train Loss: 0.2447, Acc: 0.9176 | Val Loss: 0.8883, Acc: 0.7542 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.2357, Acc: 0.9209 | Val Loss: 0.8864, Acc: 0.7572 | LR: 1.0e-06
✨ New best val acc: 0.7572
Training finished in 33.86 min. Best Val Acc: 0.7572
Final Test Accuracy (using best val wts): 0.7519
S2_Param_mlp_ratio_2: Best Val Acc = 0.7572, Final Test Acc = 0.7519

--- Testing S2_Param_deeper (Diff-ViT) ---

--- Running Tuning Config: S2_Param_deeper ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 256,
  "depth": 12,
  "num_heads": 8,
  "mlp_ratio": 4.0,
  "batch_size": 128,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 12,666,134
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.9307, Acc: 0.2849 | Val Loss: 1.6340, Acc: 0.4070 | LR: 6.0e-05
✨ New best val acc: 0.4070
Epoch 2/20 - Train Loss: 1.4868, Acc: 0.4600 | Val Loss: 1.3596, Acc: 0.5068 | LR: 1.2e-04
✨ New best val acc: 0.5068
Epoch 3/20 - Train Loss: 1.2938, Acc: 0.5334 | Val Loss: 1.2249, Acc: 0.5616 | LR: 1.8e-04
✨ New best val acc: 0.5616
Epoch 4/20 - Train Loss: 1.1635, Acc: 0.5815 | Val Loss: 1.1358, Acc: 0.5996 | LR: 2.4e-04
✨ New best val acc: 0.5996
Epoch 5/20 - Train Loss: 1.0537, Acc: 0.6206 | Val Loss: 1.0268, Acc: 0.6250 | LR: 3.0e-04
✨ New best val acc: 0.6250
Epoch 6/20 - Train Loss: 0.9675, Acc: 0.6532 | Val Loss: 0.9535, Acc: 0.6588 | LR: 3.0e-04
✨ New best val acc: 0.6588
Epoch 7/20 - Train Loss: 0.8718, Acc: 0.6873 | Val Loss: 0.8929, Acc: 0.6878 | LR: 2.9e-04
✨ New best val acc: 0.6878
Epoch 8/20 - Train Loss: 0.8052, Acc: 0.7141 | Val Loss: 0.8540, Acc: 0.7004 | LR: 2.7e-04
✨ New best val acc: 0.7004
Epoch 9/20 - Train Loss: 0.7418, Acc: 0.7348 | Val Loss: 0.8505, Acc: 0.7030 | LR: 2.5e-04
✨ New best val acc: 0.7030
Epoch 10/20 - Train Loss: 0.6739, Acc: 0.7610 | Val Loss: 0.8037, Acc: 0.7208 | LR: 2.3e-04
✨ New best val acc: 0.7208
Epoch 11/20 - Train Loss: 0.6076, Acc: 0.7838 | Val Loss: 0.8020, Acc: 0.7282 | LR: 2.0e-04
✨ New best val acc: 0.7282
Epoch 12/20 - Train Loss: 0.5381, Acc: 0.8102 | Val Loss: 0.7657, Acc: 0.7414 | LR: 1.7e-04
✨ New best val acc: 0.7414
Epoch 13/20 - Train Loss: 0.4735, Acc: 0.8337 | Val Loss: 0.7803, Acc: 0.7528 | LR: 1.3e-04
✨ New best val acc: 0.7528
Epoch 14/20 - Train Loss: 0.4092, Acc: 0.8560 | Val Loss: 0.7800, Acc: 0.7536 | LR: 1.0e-04
✨ New best val acc: 0.7536
Epoch 15/20 - Train Loss: 0.3447, Acc: 0.8802 | Val Loss: 0.7728, Acc: 0.7696 | LR: 7.6e-05
✨ New best val acc: 0.7696
Epoch 16/20 - Train Loss: 0.2903, Acc: 0.8997 | Val Loss: 0.8234, Acc: 0.7636 | LR: 5.0e-05
Epoch 17/20 - Train Loss: 0.2442, Acc: 0.9171 | Val Loss: 0.8297, Acc: 0.7666 | LR: 3.0e-05
Epoch 18/20 - Train Loss: 0.2143, Acc: 0.9268 | Val Loss: 0.8583, Acc: 0.7644 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.1974, Acc: 0.9342 | Val Loss: 0.8607, Acc: 0.7684 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.1861, Acc: 0.9385 | Val Loss: 0.8692, Acc: 0.7678 | LR: 1.0e-06
Training finished in 56.87 min. Best Val Acc: 0.7696
Final Test Accuracy (using best val wts): 0.7623
S2_Param_deeper: Best Val Acc = 0.7696, Final Test Acc = 0.7623
*** New best for Stage 2: S2_Param_deeper (Val Acc: 0.7696) ***
*** New OVERALL Best Diff-ViT Found! (From S2_Param_deeper, Val Acc: 0.7696) ***

--- Testing S2_Param_wider (Diff-ViT) ---

--- Running Tuning Config: S2_Param_wider ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,973,330
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.8131, Acc: 0.3320 | Val Loss: 1.4418, Acc: 0.4864 | LR: 6.0e-05
✨ New best val acc: 0.4864
Epoch 2/20 - Train Loss: 1.3928, Acc: 0.4951 | Val Loss: 1.2435, Acc: 0.5520 | LR: 1.2e-04
✨ New best val acc: 0.5520
Epoch 3/20 - Train Loss: 1.2216, Acc: 0.5590 | Val Loss: 1.1838, Acc: 0.5724 | LR: 1.8e-04
✨ New best val acc: 0.5724
Epoch 4/20 - Train Loss: 1.1042, Acc: 0.6047 | Val Loss: 1.0472, Acc: 0.6204 | LR: 2.4e-04
✨ New best val acc: 0.6204
Epoch 5/20 - Train Loss: 1.0176, Acc: 0.6354 | Val Loss: 0.9894, Acc: 0.6378 | LR: 3.0e-04
✨ New best val acc: 0.6378
Epoch 6/20 - Train Loss: 0.9536, Acc: 0.6580 | Val Loss: 0.9676, Acc: 0.6662 | LR: 3.0e-04
✨ New best val acc: 0.6662
Epoch 7/20 - Train Loss: 0.8779, Acc: 0.6869 | Val Loss: 0.8719, Acc: 0.6886 | LR: 2.9e-04
✨ New best val acc: 0.6886
Epoch 8/20 - Train Loss: 0.8104, Acc: 0.7129 | Val Loss: 0.8539, Acc: 0.6974 | LR: 2.7e-04
✨ New best val acc: 0.6974
Epoch 9/20 - Train Loss: 0.7336, Acc: 0.7385 | Val Loss: 0.7931, Acc: 0.7262 | LR: 2.5e-04
✨ New best val acc: 0.7262
Epoch 10/20 - Train Loss: 0.6688, Acc: 0.7628 | Val Loss: 0.7559, Acc: 0.7378 | LR: 2.3e-04
✨ New best val acc: 0.7378
Epoch 11/20 - Train Loss: 0.5985, Acc: 0.7889 | Val Loss: 0.7485, Acc: 0.7460 | LR: 2.0e-04
✨ New best val acc: 0.7460
Epoch 12/20 - Train Loss: 0.5206, Acc: 0.8148 | Val Loss: 0.7337, Acc: 0.7574 | LR: 1.7e-04
✨ New best val acc: 0.7574
Epoch 13/20 - Train Loss: 0.4500, Acc: 0.8406 | Val Loss: 0.7327, Acc: 0.7654 | LR: 1.3e-04
✨ New best val acc: 0.7654
Epoch 14/20 - Train Loss: 0.3740, Acc: 0.8685 | Val Loss: 0.7581, Acc: 0.7738 | LR: 1.0e-04
✨ New best val acc: 0.7738
Epoch 15/20 - Train Loss: 0.3090, Acc: 0.8919 | Val Loss: 0.7253, Acc: 0.7870 | LR: 7.6e-05
✨ New best val acc: 0.7870
Epoch 16/20 - Train Loss: 0.2527, Acc: 0.9127 | Val Loss: 0.7872, Acc: 0.7806 | LR: 5.0e-05
Epoch 17/20 - Train Loss: 0.2085, Acc: 0.9285 | Val Loss: 0.8127, Acc: 0.7858 | LR: 3.0e-05
Epoch 18/20 - Train Loss: 0.1780, Acc: 0.9398 | Val Loss: 0.8112, Acc: 0.7892 | LR: 1.4e-05
✨ New best val acc: 0.7892
Epoch 19/20 - Train Loss: 0.1589, Acc: 0.9475 | Val Loss: 0.8398, Acc: 0.7888 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.1519, Acc: 0.9500 | Val Loss: 0.8300, Acc: 0.7900 | LR: 1.0e-06
✨ New best val acc: 0.7900
Training finished in 66.19 min. Best Val Acc: 0.7900
Final Test Accuracy (using best val wts): 0.7900
S2_Param_wider: Best Val Acc = 0.7900, Final Test Acc = 0.7900
*** New best for Stage 2: S2_Param_wider (Val Acc: 0.7900) ***
*** New OVERALL Best Diff-ViT Found! (From S2_Param_wider, Val Acc: 0.7900) ***

--- Testing S2_Param_smaller (Diff-ViT) ---

--- Running Tuning Config: S2_Param_smaller ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 192,
  "depth": 6,
  "num_heads": 6,
  "mlp_ratio": 4.0,
  "batch_size": 128,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 3,582,544
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 2.0529, Acc: 0.2390 | Val Loss: 1.7411, Acc: 0.3746 | LR: 6.0e-05
✨ New best val acc: 0.3746
Epoch 2/20 - Train Loss: 1.5842, Acc: 0.4227 | Val Loss: 1.4550, Acc: 0.4704 | LR: 1.2e-04
✨ New best val acc: 0.4704
Epoch 3/20 - Train Loss: 1.3709, Acc: 0.5041 | Val Loss: 1.3103, Acc: 0.5138 | LR: 1.8e-04
✨ New best val acc: 0.5138
Epoch 4/20 - Train Loss: 1.2264, Acc: 0.5545 | Val Loss: 1.1651, Acc: 0.5734 | LR: 2.4e-04
✨ New best val acc: 0.5734
Epoch 5/20 - Train Loss: 1.1234, Acc: 0.5952 | Val Loss: 1.1053, Acc: 0.6072 | LR: 3.0e-04
✨ New best val acc: 0.6072
Epoch 6/20 - Train Loss: 1.0370, Acc: 0.6274 | Val Loss: 0.9845, Acc: 0.6446 | LR: 3.0e-04
✨ New best val acc: 0.6446
Epoch 7/20 - Train Loss: 0.9573, Acc: 0.6567 | Val Loss: 0.9492, Acc: 0.6588 | LR: 2.9e-04
✨ New best val acc: 0.6588
Epoch 8/20 - Train Loss: 0.8941, Acc: 0.6788 | Val Loss: 0.9163, Acc: 0.6728 | LR: 2.7e-04
✨ New best val acc: 0.6728
Epoch 9/20 - Train Loss: 0.8304, Acc: 0.7021 | Val Loss: 0.8991, Acc: 0.6876 | LR: 2.5e-04
✨ New best val acc: 0.6876
Epoch 10/20 - Train Loss: 0.7744, Acc: 0.7232 | Val Loss: 0.8834, Acc: 0.7006 | LR: 2.3e-04
✨ New best val acc: 0.7006
Epoch 11/20 - Train Loss: 0.7177, Acc: 0.7437 | Val Loss: 0.8652, Acc: 0.7066 | LR: 2.0e-04
✨ New best val acc: 0.7066
Epoch 12/20 - Train Loss: 0.6650, Acc: 0.7622 | Val Loss: 0.8001, Acc: 0.7254 | LR: 1.7e-04
✨ New best val acc: 0.7254
Epoch 13/20 - Train Loss: 0.6110, Acc: 0.7814 | Val Loss: 0.8245, Acc: 0.7246 | LR: 1.3e-04
Epoch 14/20 - Train Loss: 0.5586, Acc: 0.8016 | Val Loss: 0.8200, Acc: 0.7358 | LR: 1.0e-04
✨ New best val acc: 0.7358
Epoch 15/20 - Train Loss: 0.5085, Acc: 0.8190 | Val Loss: 0.8070, Acc: 0.7412 | LR: 7.6e-05
✨ New best val acc: 0.7412
Epoch 16/20 - Train Loss: 0.4601, Acc: 0.8369 | Val Loss: 0.8307, Acc: 0.7386 | LR: 5.0e-05
Epoch 17/20 - Train Loss: 0.4285, Acc: 0.8484 | Val Loss: 0.8170, Acc: 0.7506 | LR: 3.0e-05
✨ New best val acc: 0.7506
Epoch 18/20 - Train Loss: 0.3985, Acc: 0.8615 | Val Loss: 0.8181, Acc: 0.7500 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.3832, Acc: 0.8671 | Val Loss: 0.8279, Acc: 0.7496 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.3735, Acc: 0.8703 | Val Loss: 0.8288, Acc: 0.7496 | LR: 1.0e-06
Training finished in 21.04 min. Best Val Acc: 0.7506
Final Test Accuracy (using best val wts): 0.7428
S2_Param_smaller: Best Val Acc = 0.7506, Final Test Acc = 0.7428

--- Stage 2 Result (Duration: 216.85 min): Best Model Config = 'wider' (Val Acc: 0.7900) ---

--- Saving Best Results for Stage2_Model (ID: S2_Param_wider, Val Acc: 0.7900) ---
[Stage2_Model] Saved best config to results_diff_vit_tuned/best_config_diff_vit_S2_Param_wider.json
[Stage2_Model] Saved best model state_dict to results_diff_vit_tuned/models/best_diff_vit_S2_Param_wider.pth
Saved plot: best_curves_diff_vit_S2_Param_wider.png

=============== Stage 3: Data Augmentation Tuning (20 Epochs) ===============

--- Testing S3_Aug_None (Diff-ViT) ---
Augmentations: None

--- Running Tuning Config: S3_Aug_None ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: None
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,973,330
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.9281, Acc: 0.2833 | Val Loss: 1.6703, Acc: 0.3858 | LR: 6.0e-05
✨ New best val acc: 0.3858
Epoch 2/20 - Train Loss: 1.5092, Acc: 0.4508 | Val Loss: 1.4618, Acc: 0.4826 | LR: 1.2e-04
✨ New best val acc: 0.4826
Epoch 3/20 - Train Loss: 1.3469, Acc: 0.5105 | Val Loss: 1.2834, Acc: 0.5322 | LR: 1.8e-04
✨ New best val acc: 0.5322
Epoch 4/20 - Train Loss: 1.2493, Acc: 0.5478 | Val Loss: 1.2149, Acc: 0.5520 | LR: 2.4e-04
✨ New best val acc: 0.5520
Epoch 5/20 - Train Loss: 1.1832, Acc: 0.5735 | Val Loss: 1.1629, Acc: 0.5812 | LR: 3.0e-04
✨ New best val acc: 0.5812
Epoch 6/20 - Train Loss: 1.0929, Acc: 0.6063 | Val Loss: 1.0703, Acc: 0.6166 | LR: 3.0e-04
✨ New best val acc: 0.6166
Epoch 7/20 - Train Loss: 1.0066, Acc: 0.6393 | Val Loss: 1.0186, Acc: 0.6382 | LR: 2.9e-04
✨ New best val acc: 0.6382
Epoch 8/20 - Train Loss: 0.9389, Acc: 0.6615 | Val Loss: 0.9974, Acc: 0.6482 | LR: 2.7e-04
✨ New best val acc: 0.6482
Epoch 9/20 - Train Loss: 0.8705, Acc: 0.6862 | Val Loss: 0.9540, Acc: 0.6612 | LR: 2.5e-04
✨ New best val acc: 0.6612
Epoch 10/20 - Train Loss: 0.8026, Acc: 0.7133 | Val Loss: 0.9247, Acc: 0.6658 | LR: 2.3e-04
✨ New best val acc: 0.6658
Epoch 11/20 - Train Loss: 0.7205, Acc: 0.7409 | Val Loss: 0.9325, Acc: 0.6802 | LR: 2.0e-04
✨ New best val acc: 0.6802
Epoch 12/20 - Train Loss: 0.6412, Acc: 0.7700 | Val Loss: 0.8965, Acc: 0.6894 | LR: 1.7e-04
✨ New best val acc: 0.6894
Epoch 13/20 - Train Loss: 0.5387, Acc: 0.8085 | Val Loss: 0.9296, Acc: 0.6994 | LR: 1.3e-04
✨ New best val acc: 0.6994
Epoch 14/20 - Train Loss: 0.4405, Acc: 0.8421 | Val Loss: 0.9368, Acc: 0.7098 | LR: 1.0e-04
✨ New best val acc: 0.7098
Epoch 15/20 - Train Loss: 0.3390, Acc: 0.8798 | Val Loss: 0.9911, Acc: 0.7128 | LR: 7.6e-05
✨ New best val acc: 0.7128
Epoch 16/20 - Train Loss: 0.2432, Acc: 0.9143 | Val Loss: 1.0372, Acc: 0.7176 | LR: 5.0e-05
✨ New best val acc: 0.7176
Epoch 17/20 - Train Loss: 0.1671, Acc: 0.9416 | Val Loss: 1.1303, Acc: 0.7168 | LR: 3.0e-05
Epoch 18/20 - Train Loss: 0.1239, Acc: 0.9582 | Val Loss: 1.1953, Acc: 0.7206 | LR: 1.4e-05
✨ New best val acc: 0.7206
Epoch 19/20 - Train Loss: 0.0964, Acc: 0.9683 | Val Loss: 1.2168, Acc: 0.7204 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.0828, Acc: 0.9736 | Val Loss: 1.2298, Acc: 0.7208 | LR: 1.0e-06
✨ New best val acc: 0.7208
Training finished in 33.84 min. Best Val Acc: 0.7208
Final Test Accuracy (using best val wts): 0.7223
S3_Aug_None: Best Val Acc = 0.7208, Final Test Acc = 0.7223
*** New best for Stage 3: S3_Aug_None (Val Acc: 0.7208) ***

--- Testing S3_Aug_Mild (Diff-ViT) ---
Augmentations: ['random_crop', 'horizontal_flip']

--- Running Tuning Config: S3_Aug_Mild ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,973,330
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.8173, Acc: 0.3310 | Val Loss: 1.5230, Acc: 0.4540 | LR: 6.0e-05
✨ New best val acc: 0.4540
Epoch 2/20 - Train Loss: 1.3844, Acc: 0.4957 | Val Loss: 1.2714, Acc: 0.5390 | LR: 1.2e-04
✨ New best val acc: 0.5390
Epoch 3/20 - Train Loss: 1.2237, Acc: 0.5594 | Val Loss: 1.2156, Acc: 0.5652 | LR: 1.8e-04
✨ New best val acc: 0.5652
Epoch 4/20 - Train Loss: 1.1061, Acc: 0.6001 | Val Loss: 1.1240, Acc: 0.5984 | LR: 2.4e-04
✨ New best val acc: 0.5984
Epoch 5/20 - Train Loss: 1.0186, Acc: 0.6335 | Val Loss: 0.9804, Acc: 0.6500 | LR: 3.0e-04
✨ New best val acc: 0.6500
Epoch 6/20 - Train Loss: 0.9555, Acc: 0.6575 | Val Loss: 0.9823, Acc: 0.6484 | LR: 3.0e-04
Epoch 7/20 - Train Loss: 0.8788, Acc: 0.6868 | Val Loss: 0.9318, Acc: 0.6792 | LR: 2.9e-04
✨ New best val acc: 0.6792
Epoch 8/20 - Train Loss: 0.8109, Acc: 0.7124 | Val Loss: 0.8763, Acc: 0.6950 | LR: 2.7e-04
✨ New best val acc: 0.6950
Epoch 9/20 - Train Loss: 0.7330, Acc: 0.7392 | Val Loss: 0.8085, Acc: 0.7206 | LR: 2.5e-04
✨ New best val acc: 0.7206
Epoch 10/20 - Train Loss: 0.6605, Acc: 0.7651 | Val Loss: 0.7571, Acc: 0.7408 | LR: 2.3e-04
✨ New best val acc: 0.7408
Epoch 11/20 - Train Loss: 0.5893, Acc: 0.7916 | Val Loss: 0.7483, Acc: 0.7440 | LR: 2.0e-04
✨ New best val acc: 0.7440
Epoch 12/20 - Train Loss: 0.5205, Acc: 0.8155 | Val Loss: 0.6954, Acc: 0.7612 | LR: 1.7e-04
✨ New best val acc: 0.7612
Epoch 13/20 - Train Loss: 0.4434, Acc: 0.8432 | Val Loss: 0.7067, Acc: 0.7720 | LR: 1.3e-04
✨ New best val acc: 0.7720
Epoch 14/20 - Train Loss: 0.3711, Acc: 0.8700 | Val Loss: 0.7058, Acc: 0.7770 | LR: 1.0e-04
✨ New best val acc: 0.7770
Epoch 15/20 - Train Loss: 0.3024, Acc: 0.8958 | Val Loss: 0.7231, Acc: 0.7846 | LR: 7.6e-05
✨ New best val acc: 0.7846
Epoch 16/20 - Train Loss: 0.2487, Acc: 0.9149 | Val Loss: 0.7744, Acc: 0.7884 | LR: 5.0e-05
✨ New best val acc: 0.7884
Epoch 17/20 - Train Loss: 0.2074, Acc: 0.9297 | Val Loss: 0.7651, Acc: 0.7920 | LR: 3.0e-05
✨ New best val acc: 0.7920
Epoch 18/20 - Train Loss: 0.1730, Acc: 0.9422 | Val Loss: 0.7901, Acc: 0.7890 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.1522, Acc: 0.9492 | Val Loss: 0.8081, Acc: 0.7884 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.1458, Acc: 0.9523 | Val Loss: 0.8060, Acc: 0.7886 | LR: 1.0e-06
Training finished in 67.69 min. Best Val Acc: 0.7920
Final Test Accuracy (using best val wts): 0.7906
S3_Aug_Mild: Best Val Acc = 0.7920, Final Test Acc = 0.7906
*** New best for Stage 3: S3_Aug_Mild (Val Acc: 0.7920) ***
*** New OVERALL Best Diff-ViT Found! (From S3_Aug_Mild, Val Acc: 0.7920) ***

--- Stage 3 Result (Duration: 101.92 min): Best Aug Strategy = 'Mild' (Val Acc: 0.7920) ---

--- Saving Best Results for Stage3_Aug (ID: S3_Aug_Mild, Val Acc: 0.7920) ---
[Stage3_Aug] Saved best config to results_diff_vit_tuned/best_config_diff_vit_S3_Aug_Mild.json
[Stage3_Aug] Saved best model state_dict to results_diff_vit_tuned/models/best_diff_vit_S3_Aug_Mild.pth
Saved plot: best_curves_diff_vit_S3_Aug_Mild.png

=============== Stage 4: Positional Embedding Tuning (20 Epochs) ===============

--- Testing S4_PE_1d_learned (Diff-ViT) ---

--- Running Tuning Config: S4_PE_1d_learned ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "1d_learned",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: 1d_learned
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,973,330
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.8168, Acc: 0.3304 | Val Loss: 1.5667, Acc: 0.4376 | LR: 6.0e-05
✨ New best val acc: 0.4376
Epoch 2/20 - Train Loss: 1.3935, Acc: 0.4940 | Val Loss: 1.2913, Acc: 0.5350 | LR: 1.2e-04
✨ New best val acc: 0.5350
Epoch 3/20 - Train Loss: 1.2220, Acc: 0.5580 | Val Loss: 1.2113, Acc: 0.5576 | LR: 1.8e-04
✨ New best val acc: 0.5576
Epoch 4/20 - Train Loss: 1.0992, Acc: 0.6033 | Val Loss: 1.0342, Acc: 0.6332 | LR: 2.4e-04
✨ New best val acc: 0.6332
Epoch 5/20 - Train Loss: 1.0119, Acc: 0.6371 | Val Loss: 1.0396, Acc: 0.6398 | LR: 3.0e-04
✨ New best val acc: 0.6398
Epoch 6/20 - Train Loss: 0.9523, Acc: 0.6606 | Val Loss: 0.9718, Acc: 0.6580 | LR: 3.0e-04
✨ New best val acc: 0.6580
Epoch 7/20 - Train Loss: 0.8785, Acc: 0.6857 | Val Loss: 0.9175, Acc: 0.6804 | LR: 2.9e-04
✨ New best val acc: 0.6804
Epoch 8/20 - Train Loss: 0.8066, Acc: 0.7149 | Val Loss: 0.8438, Acc: 0.7074 | LR: 2.7e-04
✨ New best val acc: 0.7074
Epoch 9/20 - Train Loss: 0.7388, Acc: 0.7379 | Val Loss: 0.7916, Acc: 0.7274 | LR: 2.5e-04
✨ New best val acc: 0.7274
Epoch 10/20 - Train Loss: 0.6631, Acc: 0.7632 | Val Loss: 0.7670, Acc: 0.7356 | LR: 2.3e-04
✨ New best val acc: 0.7356
Epoch 11/20 - Train Loss: 0.5914, Acc: 0.7909 | Val Loss: 0.7072, Acc: 0.7604 | LR: 2.0e-04
✨ New best val acc: 0.7604
Epoch 12/20 - Train Loss: 0.5161, Acc: 0.8180 | Val Loss: 0.7453, Acc: 0.7552 | LR: 1.7e-04
Epoch 13/20 - Train Loss: 0.4442, Acc: 0.8434 | Val Loss: 0.7106, Acc: 0.7734 | LR: 1.3e-04
✨ New best val acc: 0.7734
Epoch 14/20 - Train Loss: 0.3691, Acc: 0.8701 | Val Loss: 0.7154, Acc: 0.7828 | LR: 1.0e-04
✨ New best val acc: 0.7828
Epoch 15/20 - Train Loss: 0.3030, Acc: 0.8945 | Val Loss: 0.7444, Acc: 0.7870 | LR: 7.6e-05
✨ New best val acc: 0.7870
Epoch 16/20 - Train Loss: 0.2492, Acc: 0.9140 | Val Loss: 0.7509, Acc: 0.7922 | LR: 5.0e-05
✨ New best val acc: 0.7922
Epoch 17/20 - Train Loss: 0.2019, Acc: 0.9313 | Val Loss: 0.7897, Acc: 0.7966 | LR: 3.0e-05
✨ New best val acc: 0.7966
Epoch 18/20 - Train Loss: 0.1718, Acc: 0.9417 | Val Loss: 0.8092, Acc: 0.7956 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.1530, Acc: 0.9491 | Val Loss: 0.7981, Acc: 0.7984 | LR: 4.3e-06
✨ New best val acc: 0.7984
Epoch 20/20 - Train Loss: 0.1436, Acc: 0.9522 | Val Loss: 0.8047, Acc: 0.8000 | LR: 1.0e-06
✨ New best val acc: 0.8000
Training finished in 65.90 min. Best Val Acc: 0.8000
Final Test Accuracy (using best val wts): 0.7934
S4_PE_1d_learned: Best Val Acc = 0.8000, Final Test Acc = 0.7934
*** New best for Stage 4: S4_PE_1d_learned (Val Acc: 0.8000) ***
*** New OVERALL Best Diff-ViT Found! (From S4_PE_1d_learned, Val Acc: 0.8000) ***

--- Testing S4_PE_sinusoidal (Diff-ViT) ---

--- Running Tuning Config: S4_PE_sinusoidal ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "sinusoidal",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: sinusoidal
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,948,370
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.7157, Acc: 0.3738 | Val Loss: 1.2793, Acc: 0.5394 | LR: 6.0e-05
✨ New best val acc: 0.5394
Epoch 2/20 - Train Loss: 1.2274, Acc: 0.5577 | Val Loss: 1.1532, Acc: 0.5906 | LR: 1.2e-04
✨ New best val acc: 0.5906
Epoch 3/20 - Train Loss: 1.0482, Acc: 0.6266 | Val Loss: 0.9884, Acc: 0.6404 | LR: 1.8e-04
✨ New best val acc: 0.6404
Epoch 4/20 - Train Loss: 0.9479, Acc: 0.6616 | Val Loss: 0.9806, Acc: 0.6596 | LR: 2.4e-04
✨ New best val acc: 0.6596
Epoch 5/20 - Train Loss: 0.8783, Acc: 0.6886 | Val Loss: 0.8918, Acc: 0.6900 | LR: 3.0e-04
✨ New best val acc: 0.6900
Epoch 6/20 - Train Loss: 0.8235, Acc: 0.7082 | Val Loss: 0.8457, Acc: 0.7016 | LR: 3.0e-04
✨ New best val acc: 0.7016
Epoch 7/20 - Train Loss: 0.7505, Acc: 0.7341 | Val Loss: 0.8108, Acc: 0.7160 | LR: 2.9e-04
✨ New best val acc: 0.7160
Epoch 8/20 - Train Loss: 0.6872, Acc: 0.7554 | Val Loss: 0.7549, Acc: 0.7326 | LR: 2.7e-04
✨ New best val acc: 0.7326
Epoch 9/20 - Train Loss: 0.6188, Acc: 0.7798 | Val Loss: 0.7323, Acc: 0.7422 | LR: 2.5e-04
✨ New best val acc: 0.7422
Epoch 10/20 - Train Loss: 0.5522, Acc: 0.8048 | Val Loss: 0.7083, Acc: 0.7660 | LR: 2.3e-04
✨ New best val acc: 0.7660
Epoch 11/20 - Train Loss: 0.4773, Acc: 0.8304 | Val Loss: 0.6511, Acc: 0.7770 | LR: 2.0e-04
✨ New best val acc: 0.7770
Epoch 12/20 - Train Loss: 0.4077, Acc: 0.8570 | Val Loss: 0.6646, Acc: 0.7874 | LR: 1.7e-04
✨ New best val acc: 0.7874
Epoch 13/20 - Train Loss: 0.3321, Acc: 0.8832 | Val Loss: 0.7113, Acc: 0.7876 | LR: 1.3e-04
✨ New best val acc: 0.7876
Epoch 14/20 - Train Loss: 0.2722, Acc: 0.9061 | Val Loss: 0.6935, Acc: 0.7978 | LR: 1.0e-04
✨ New best val acc: 0.7978
Epoch 15/20 - Train Loss: 0.2166, Acc: 0.9253 | Val Loss: 0.7829, Acc: 0.7928 | LR: 7.6e-05
Epoch 16/20 - Train Loss: 0.1714, Acc: 0.9420 | Val Loss: 0.7434, Acc: 0.8032 | LR: 5.0e-05
✨ New best val acc: 0.8032
Epoch 17/20 - Train Loss: 0.1394, Acc: 0.9544 | Val Loss: 0.7712, Acc: 0.8100 | LR: 3.0e-05
✨ New best val acc: 0.8100
Epoch 18/20 - Train Loss: 0.1142, Acc: 0.9618 | Val Loss: 0.7967, Acc: 0.8030 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.1017, Acc: 0.9662 | Val Loss: 0.7972, Acc: 0.8090 | LR: 4.3e-06
Epoch 20/20 - Train Loss: 0.0949, Acc: 0.9687 | Val Loss: 0.8028, Acc: 0.8078 | LR: 1.0e-06
Training finished in 67.87 min. Best Val Acc: 0.8100
Final Test Accuracy (using best val wts): 0.8084
S4_PE_sinusoidal: Best Val Acc = 0.8100, Final Test Acc = 0.8084
*** New best for Stage 4: S4_PE_sinusoidal (Val Acc: 0.8100) ***
*** New OVERALL Best Diff-ViT Found! (From S4_PE_sinusoidal, Val Acc: 0.8100) ***

--- Testing S4_PE_no_pos (Diff-ViT) ---

--- Running Tuning Config: S4_PE_no_pos ---
Parameters: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "no_pos",
  "n_workers": 20
}
Data Augmentations: ['random_crop', 'horizontal_flip']
Positional Embedding: no_pos
Number of Epochs: 20
Files already downloaded and verified
Files already downloaded and verified
Diff-ViT Model Params: 18,948,370
Starting training for 20 epochs...
Epoch 1/20 - Train Loss: 1.8373, Acc: 0.3228 | Val Loss: 1.5503, Acc: 0.4426 | LR: 6.0e-05
✨ New best val acc: 0.4426
Epoch 2/20 - Train Loss: 1.4105, Acc: 0.4888 | Val Loss: 1.3571, Acc: 0.5000 | LR: 1.2e-04
✨ New best val acc: 0.5000
Epoch 3/20 - Train Loss: 1.2524, Acc: 0.5491 | Val Loss: 1.1900, Acc: 0.5700 | LR: 1.8e-04
✨ New best val acc: 0.5700
Epoch 4/20 - Train Loss: 1.1692, Acc: 0.5794 | Val Loss: 1.1544, Acc: 0.5822 | LR: 2.4e-04
✨ New best val acc: 0.5822
Epoch 5/20 - Train Loss: 1.1265, Acc: 0.5967 | Val Loss: 1.1051, Acc: 0.5964 | LR: 3.0e-04
✨ New best val acc: 0.5964
Epoch 6/20 - Train Loss: 1.0840, Acc: 0.6112 | Val Loss: 1.1223, Acc: 0.5960 | LR: 3.0e-04
Epoch 7/20 - Train Loss: 1.0275, Acc: 0.6332 | Val Loss: 1.0777, Acc: 0.6152 | LR: 2.9e-04
✨ New best val acc: 0.6152
Epoch 8/20 - Train Loss: 0.9714, Acc: 0.6518 | Val Loss: 1.0229, Acc: 0.6308 | LR: 2.7e-04
✨ New best val acc: 0.6308
Epoch 9/20 - Train Loss: 0.9091, Acc: 0.6749 | Val Loss: 1.0024, Acc: 0.6444 | LR: 2.5e-04
✨ New best val acc: 0.6444
Epoch 10/20 - Train Loss: 0.8414, Acc: 0.6987 | Val Loss: 0.9433, Acc: 0.6638 | LR: 2.3e-04
✨ New best val acc: 0.6638
Epoch 11/20 - Train Loss: 0.7739, Acc: 0.7246 | Val Loss: 0.9712, Acc: 0.6610 | LR: 2.0e-04
Epoch 12/20 - Train Loss: 0.6965, Acc: 0.7528 | Val Loss: 0.9386, Acc: 0.6862 | LR: 1.7e-04
✨ New best val acc: 0.6862
Epoch 13/20 - Train Loss: 0.6199, Acc: 0.7786 | Val Loss: 0.9294, Acc: 0.6966 | LR: 1.3e-04
✨ New best val acc: 0.6966
Epoch 14/20 - Train Loss: 0.5349, Acc: 0.8099 | Val Loss: 0.9581, Acc: 0.7004 | LR: 1.0e-04
✨ New best val acc: 0.7004
Epoch 15/20 - Train Loss: 0.4583, Acc: 0.8377 | Val Loss: 0.9595, Acc: 0.7086 | LR: 7.6e-05
✨ New best val acc: 0.7086
Epoch 16/20 - Train Loss: 0.3925, Acc: 0.8638 | Val Loss: 0.9764, Acc: 0.7116 | LR: 5.0e-05
✨ New best val acc: 0.7116
Epoch 17/20 - Train Loss: 0.3404, Acc: 0.8829 | Val Loss: 1.0082, Acc: 0.7208 | LR: 3.0e-05
✨ New best val acc: 0.7208
Epoch 18/20 - Train Loss: 0.2975, Acc: 0.9000 | Val Loss: 1.0663, Acc: 0.7198 | LR: 1.4e-05
Epoch 19/20 - Train Loss: 0.2728, Acc: 0.9086 | Val Loss: 1.0627, Acc: 0.7238 | LR: 4.3e-06
✨ New best val acc: 0.7238
Epoch 20/20 - Train Loss: 0.2649, Acc: 0.9121 | Val Loss: 1.0680, Acc: 0.7250 | LR: 1.0e-06
✨ New best val acc: 0.7250
Training finished in 67.87 min. Best Val Acc: 0.7250
Final Test Accuracy (using best val wts): 0.7215
S4_PE_no_pos: Best Val Acc = 0.7250, Final Test Acc = 0.7215

--- Stage 4 Result (Duration: 202.24 min): Best Pos Embed Type = 'sinusoidal' (Val Acc: 0.8100) ---

--- Saving Best Results for Stage4_Pos (ID: S4_PE_sinusoidal, Val Acc: 0.8100) ---
[Stage4_Pos] Saved best config to results_diff_vit_tuned/best_config_diff_vit_S4_PE_sinusoidal.json
[Stage4_Pos] Saved best model state_dict to results_diff_vit_tuned/models/best_diff_vit_S4_PE_sinusoidal.pth
Saved plot: best_curves_diff_vit_S4_PE_sinusoidal.png

=============== Final Overall Diff-ViT Results & Saving ===============
Overall Best Diff-ViT Val Acc: 0.8100 (Achieved in Stage 4 (Pos Embed), Run: S4_PE_sinusoidal)
Overall Best Diff-ViT Test Acc (for that run): 0.8084
Final Overall Best Diff-ViT Config: {
  "img_size": 32,
  "patch_size": 4,
  "embed_dim": 384,
  "depth": 8,
  "num_heads": 12,
  "mlp_ratio": 4.0,
  "batch_size": 64,
  "learning_rate": 0.0003,
  "weight_decay": 0.05,
  "drop_rate": 0.1,
  "attn_drop_rate": 0.1,
  "warmup_epochs": 5,
  "pos_embed_type": "sinusoidal",
  "n_workers": 20,
  "data_augmentation_names": [
    "random_crop",
    "horizontal_flip"
  ],
  "overall_best_val_accuracy": 0.81,
  "overall_best_test_accuracy": 0.8084,
  "overall_best_stage_achieved": "Stage 4 (Pos Embed)",
  "overall_best_run_id": "S4_PE_sinusoidal"
}
Saved final overall best config to results_diff_vit_tuned/best_config_diff_vit_overall_tuned.json
Saved final overall best model state_dict to results_diff_vit_tuned/models/best_diff_vit_overall_tuned.pth
Saved plot: best_train_curves_diff_vit_overall_tuned.png

--- Re-evaluating Final Overall Best Diff-ViT Model on Test Set ---
Files already downloaded and verified
Files already downloaded and verified
Final Test Accuracy of saved overall best Diff-ViT model: 0.8084
Saved tuning log to results_diff_vit_tuned/tuning_log_diff_vit.txt

=== Diff-ViT Sequential Tuning Script Finished ===
----------------------------------------------------
## JOB FINISHING
----------------------------------------------------
Python script finished with exit code: 0
Job Finished: Mon Apr 21 08:01:14 IST 2025
----------------------------------------------------
